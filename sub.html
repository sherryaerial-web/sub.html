<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä»£èª²é ˜å–ç³»çµ±</title>
  <style>
    body { font-family: sans-serif; background: #f4f7f6; padding: 15px; }
    .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .course-item { border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
    .ask-info { color: #d35400; font-weight: bold; background: #fff3e0; padding: 5px; border-radius: 5px; display: inline-block; margin: 10px 0; }
    .btn { width: 100%; background: #27ae60; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ™‹ ä»£èª²é ˜å–æ¸…å–®</h2>
    <div id="list">è¼‰å…¥ä¸­...</div>
  </div>

  <script>
    const API = "å¦³çš„GASç¶²å€"; // è¨˜å¾—æ›æˆå¦³éƒ¨ç½²å¾Œçš„ç¶²å€

    window.onload = () => {
      fetch(`${API}?action=getCourse&isAdmin=true`)
        .then(r => r.json())
        .then(data => {
          // åªé¡¯ç¤ºã€Œç¢ºèªä¸­ã€ä¸”ã€Œä»£èª²è€å¸«(Gæ¬„)ç‚ºç©ºã€çš„è³‡æ–™
          const list = data.filter(c => c['ç‹€æ…‹'] === 'ç¢ºèªä¸­' && (!c['ä»£èª²è€å¸«'] || c['ä»£èª²è€å¸«'] === ""));
          const container = document.getElementById('list');
          
          if(list.length === 0) {
            container.innerHTML = "ç›®å‰æ²’æœ‰å¾…ä»£èª²çš„èª²ç¨‹ã€‚";
            return;
          }

          container.innerHTML = list.map(item => `
            <div class="course-item">
              <strong>${item['æŒ‡å°è€…']} è€å¸«</strong><br>
              èª²ç¨‹ï¼š${item['èª²ç¨‹']}<br>
              æ™‚é–“ï¼š${item['æ—¥æœŸ']} (${item['æ™‚é–“']})<br>
              <div class="ask-info">ğŸ“¢ ç›®å‰å„ªå…ˆè©¢å•ï¼š${item['æœ€å¾Œè©¢å•å°è±¡'] || 'ç­‰å¾…å®‰æ’ä¸­'}</div>
              <button class="btn" onclick="take('${item.rowId}', '${item['èª²ç¨‹']}')">æˆ‘å·²ç¢ºèªä»£èª²</button>
            </div>
          `).join('');
        });
    };

    function take(id, title) {
      const name = prompt("è«‹è¼¸å…¥æ‚¨çš„åå­—ä»¥ç¢ºèªé ˜å–ï¼š");
      if(!name) return;
      fetch(`${API}?action=takeCourse&rowId=${id}&subName=${encodeURIComponent(name)}`)
        .then(r => r.text())
        .then(res => {
          alert(res);
          location.reload();
        });
    }
  </script>
</body>
</html>
